<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Value network &#8212; SynTool 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=039e1c02" />
    <script src="_static/documentation_options.js?v=f2a433a1"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tree search" href="tree_search.html" />
    <link rel="prev" title="Policy network" href="policy_network.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="value-network">
<h1>Value network<a class="headerlink" href="#value-network" title="Link to this heading">¶</a></h1>
<p>This page explains how to train a value network in SynTool.</p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>During the evaluation step, the value function (or evaluation function) is used to estimate the retrosynthetic feasibility
of a newly created node. In Syntool, evaluation functions such as random function (assigns a random value), rollout function,
and value network trained with the learning from simulated experience algorithm are implemented. The architecture of the
value network is like the policy network. The molecular representation part of the neural network is the same, and the
difference is that the output linear layer returns a single value ranging from 0 to 1.</p>
<p>The value neural network is iteratively trained on training subsets extracted from the previous planning sessions
(learning from simulated experience). In the first iteration, the value network is initialized with random weights and
is used for the initial retrosynthesis planning session for N target molecules. Then, intermediate products that were
part of a successful retrosynthesis path leading to building block molecules are labeled with a positive label, and
precursors that did not lead to building blocks are labeled with a negative label. This generated training data is
used to retrain the value network to better recognize precursors leading to possible successful retrosynthetic paths.
The training task of the value network is a classification problem, where the positive class corresponds to the precursor
that leads to building blocks; otherwise, it is considered a negative class.</p>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading">¶</a></h2>
<p>The network architecture and training hyperparameters can be adjusted in the training configuration file below. The value network, its architecture, and hyperparameters can be specified in the ValueNetwork section in the training configuration file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tree</span><span class="p">:</span>
<span class="w">  </span><span class="nt">max_iterations</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">  </span><span class="nt">max_tree_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span>
<span class="w">  </span><span class="nt">max_time</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1200</span>
<span class="w">  </span><span class="nt">max_depth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9</span>
<span class="w">  </span><span class="nt">ucb_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">uct</span>
<span class="w">  </span><span class="nt">c_ucb</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="w">  </span><span class="nt">backprop_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">muzero</span>
<span class="w">  </span><span class="nt">search_strategy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">expansion_first</span>
<span class="w">  </span><span class="nt">exclude_small</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">  </span><span class="nt">init_node_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="w">  </span><span class="nt">min_mol_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6</span>
<span class="w">  </span><span class="nt">silent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="nt">node_evaluation</span><span class="p">:</span>
<span class="w">  </span><span class="nt">evaluation_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rollout</span>
<span class="w">  </span><span class="nt">evaluation_agg</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">max</span>
<span class="nt">node_expansion</span><span class="p">:</span>
<span class="w">  </span><span class="nt">top_rules</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50</span>
<span class="w">  </span><span class="nt">rule_prob_threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="w">  </span><span class="nt">priority_rules_fraction</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="nt">value_network</span><span class="p">:</span>
<span class="w">  </span><span class="nt">vector_dim</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512</span>
<span class="w">  </span><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">  </span><span class="nt">dropout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.4</span>
<span class="w">  </span><span class="nt">learning_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0005</span>
<span class="w">  </span><span class="nt">num_conv_layers</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">  </span><span class="nt">num_epoch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="nt">reinforcement</span><span class="p">:</span>
<span class="w">  </span><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span>
<span class="w">  </span><span class="nt">num_simulations</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</pre></div>
</div>
<p><strong>Configuration parameters</strong>:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>tree/max_iterations</cite> - the maximum number of iterations the tree search algorithm will perform.</p></li>
<li><p><cite>tree/max_tree_size</cite> - the maximum number of nodes that can be created in the search tree.</p></li>
<li><p><cite>tree/max_time</cite> - the maximum time (in seconds) for the tree search execution.</p></li>
<li><p><cite>tree/max_depth</cite> - the maximum depth of the tree, controlling how far the search can go from the root node.</p></li>
<li><p><cite>tree/ucb_type</cite> - the type of Upper Confidence Bound (UCB) used in the tree search. Options include “puct” (predictive UCB), “uct” (standard UCB), and “value”.</p></li>
<li><p><cite>tree/c_ucb</cite> - the parameter controlling the exploration-exploitation balance in UCB, which influences how much the algorithm favors the exploration of new paths versus the exploitation of known paths.</p></li>
<li><p><cite>tree/backprop_type</cite> - the backpropagation method used during the tree search. Options are “muzero” (model-based approach) and “cumulative” (cumulative reward approach).</p></li>
<li><p><cite>tree/search_strategy</cite> - the strategy for navigating the tree. Options are “expansion_first” (prioritizing the expansion of new nodes) and “evaluation_first” (prioritizing the evaluation of existing nodes).</p></li>
<li><p><cite>tree/exclude_small</cite> - if True, excludes small molecules from the tree, typically focusing on more complex molecules.</p></li>
<li><p><cite>tree/init_node_value</cite> - the initial value for newly created nodes in the tree. This can impact how nodes are prioritized during the search.</p></li>
<li><p><cite>tree/epsilon</cite> - this parameter is used in the epsilon-greedy strategy during node selection, representing the probability of choosing a random action for exploration. A higher value leads to more exploration.</p></li>
<li><p><cite>tree/min_mol_size</cite> - the minimum size of a molecule (in terms of the number of heavy atoms) to be considered in the search. Molecules smaller than this threshold are typically considered readily available building blocks.</p></li>
<li><p><cite>tree/silent</cite> - if True, suppresses the progress logging of the tree search.</p></li>
<li><p><cite>node_evaluation/evaluation_agg</cite> - the way the evaluation scores are aggregated. Options are “max” (using the maximum score) and “average” (using the average score).</p></li>
<li><p><cite>node_evaluation/evaluation_type</cite> - the method used for node evaluation. Options include “random” (random number between 0 and 1), “rollout” (using rollout simulations), and “gcn” (graph convolutional networks).</p></li>
<li><p><cite>node_expansion/top_rules</cite> - the maximum amount of rules to be selected for node expansion from the list of predicted reaction rules.</p></li>
<li><p><cite>node_expansion/rule_prob_threshold</cite> - the reaction rules with predicted probability lower than this parameter will be discarded.</p></li>
<li><p><cite>node_expansion/priority_rules_fraction</cite> - the fraction of priority rules in comparison to th regular rules.</p></li>
<li><p><cite>value_network/vector_dim</cite> - the dimension of the hidden layers.</p></li>
<li><p><cite>value_network/batch_size</cite> - the size of the batch of input molecular graphs.</p></li>
<li><p><cite>value_network/dropout</cite> - the dropout value.</p></li>
<li><p><cite>value_network/learning_rate</cite> - the learning rate.</p></li>
<li><p><cite>value_network/num_conv_layers</cite> - the number of convolutional layers.</p></li>
<li><p><cite>value_network/num_epoch</cite> - the number of training epochs.</p></li>
<li><p><cite>batch_size/batch_size</cite> - the size of the batch of the target molecules used for planning simultation and value network update.</p></li>
<li><p><cite>batch_size/num_simulations</cite> - the number of training epochs.</p></li>
</ul>
</div></blockquote>
</section>
<section id="cli">
<h2>CLI<a class="headerlink" href="#cli" title="Link to this heading">¶</a></h2>
<p>Value network training can be performed with the below command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>syntool<span class="w"> </span>reinforcement_value_network_training<span class="w"> </span>--config<span class="w"> </span>reinforcement.yaml<span class="w"> </span>--targets<span class="w"> </span>targets.smi<span class="w"> </span>--reaction_rules<span class="w"> </span>reaction_rules.pickle<span class="w"> </span>--building_blocks<span class="w"> </span>building_blocks.smi<span class="w"> </span>--policy_network<span class="w"> </span>ranking_policy_network/policy_network.ckpt<span class="w"> </span>--results_dir<span class="w"> </span>value_network
</pre></div>
</div>
<dl class="simple">
<dt><strong>Parameters</strong>:</dt><dd><ul class="simple">
<li><p><cite>–config</cite> is the path to the configuration file.</p></li>
<li><p><cite>–targets</cite> is the path to the file with target molecules.</p></li>
<li><p><cite>–reaction_rules</cite> is the path to the file with reactions rules.</p></li>
<li><p><cite>–building_blocks</cite> is the path to the file with building blocks.</p></li>
<li><p><cite>–policy_network</cite> is the path to the file with trained policy network (ranking or filtering).</p></li>
<li><p><cite>–results_dir</cite> is the path to the directory where the trained value network will be to be stored.</p></li>
</ul>
</dd>
</dl>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">SynTool</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_guide.html">User guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="reaction_mapping.html">Reaction mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="reaction_standardization.html">Reaction standardization</a></li>
<li class="toctree-l1"><a class="reference internal" href="reaction_filtration.html">Reaction filtration</a></li>
<li class="toctree-l1"><a class="reference internal" href="reaction_rules_extraction.html">Reaction rules extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="policy_network.html">Policy network</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Value network</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cli">CLI</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tree_search.html">Tree search</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="policy_network.html" title="previous chapter">Policy network</a></li>
      <li>Next: <a href="tree_search.html" title="next chapter">Tree search</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, University of Strasbourg / Hokkaido University.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/value_network.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>