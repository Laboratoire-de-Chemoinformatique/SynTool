<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Expansion function &#8212; Syntool 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=039e1c02" />
    <script src="_static/documentation_options.js?v=f2a433a1"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Evaluation function" href="evaluation_function.html" />
    <link rel="prev" title="Reaction rules" href="reaction_rules.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="expansion-function">
<h1>Expansion function<a class="headerlink" href="#expansion-function" title="Link to this heading">¶</a></h1>
<p>The tree nodes in MCTS are expanded by an expansion function approximated by a policy neural network.
The policy network is composed of two parts: molecular representation and prediction parts. The first part is
responsible for creating a numerical representation of molecule structure (Graph Convolution Network (GCN) blocks
and summation over atoms). The prediction part depends on the type of policy network: filtering or ranking policy
network. All the reaction rules predicted by the policy neural network are sorted by probability and the top 50 of
them are selected to be applied to the current intermediate product in the MCTS expansion step.</p>
<section id="ranking-policy-network">
<h2>Ranking policy network<a class="headerlink" href="#ranking-policy-network" title="Link to this heading">¶</a></h2>
<p>The ranking policy network is trained on a reaction dataset as a multi-class classification. Each reaction corresponds
to a vector in which the position of the positive class corresponds to a reaction rule extracted from that reaction.
All other extracted reaction rules are assigned as negative classes. The size of the class vector corresponds to the
total number of reaction rules. This approach biases the ranking policy network to prioritize reaction rules that are
likely to produce reactions similar to real ones.</p>
</section>
<section id="filtering-policy-network">
<h2>Filtering policy network<a class="headerlink" href="#filtering-policy-network" title="Link to this heading">¶</a></h2>
<p>In a filtering policy network, the prediction part is formed from two linear layers with a sigmoid activation function
that assigns the probabilities for the “regular”, as well as “priority” reaction rules, which include such
transformations as cyclization. These two vectors are then combined with a coefficient α ranging from 0 to 1.
This approach ensures that the priority reaction rules receive the highest score, followed by other regular reaction
rules. The multi-class regular and priority vectors for training the filtering policy network are obtained by applying
all reaction rules to the set of training molecules (these molecules can be extracted from any database). If the
reaction rule is successfully applied and creates a new precursor, it will be assigned a positive class in the regular
reaction rules vector, otherwise a negative class. In addition, if the reaction rule splits the molecule into two or
more structures with several heavy atoms of more than 6 or opens a cycle, the priority vector gets a positive class,
otherwise negative.</p>
<p>The type (ranking or filtering) of the policy network, its architecture, and hyperparameters can be specified in the
PolicyNetwork section in the training configuration file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">PolicyNetwork</span><span class="p">:</span>
<span class="w">  </span><span class="nt">policy_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ranking</span>
<span class="w">  </span><span class="nt">vector_dim</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512</span>
<span class="w">  </span><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500</span>
<span class="w">  </span><span class="nt">dropout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.4</span>
<span class="w">  </span><span class="nt">learning_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0005</span>
<span class="w">  </span><span class="nt">num_conv_layers</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">  </span><span class="nt">num_epoch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">  </span><span class="nt">priority_rules_fraction</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="w">  </span><span class="nt">rule_prob_threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">  </span><span class="nt">top_rules</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Syntool</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="interfaces.html">Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_cleaning.html">Data cleaning</a></li>
<li class="toctree-l1"><a class="reference internal" href="reaction_rules.html">Reaction rules</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Expansion function</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ranking-policy-network">Ranking policy network</a></li>
<li class="toctree-l2"><a class="reference internal" href="#filtering-policy-network">Filtering policy network</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="evaluation_function.html">Evaluation function</a></li>
<li class="toctree-l1"><a class="reference internal" href="tree_search.html">Tree search</a></li>
<li class="toctree-l1"><a class="reference internal" href="training.html">Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="planning.html">Planning</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="reaction_rules.html" title="previous chapter">Reaction rules</a></li>
      <li>Next: <a href="evaluation_function.html" title="next chapter">Evaluation function</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, University of Strasbourg.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/expansion_function.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>