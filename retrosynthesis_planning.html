<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Retrosynthesis planning &#8212; SynTool 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=039e1c02" />
    <script src="_static/documentation_options.js?v=f2a433a1"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Value network" href="value_network.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="retrosynthesis-planning">
<span id="id1"></span><h1>Retrosynthesis planning<a class="headerlink" href="#retrosynthesis-planning" title="Link to this heading">¶</a></h1>
<p>This page explains how to perform a retrosynthesis planning with tree search in SynTool.</p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>In SynTool retrosynthesis planning module combines the search algorithm (MCTS), reaction rules, and policy function for
their prediction in node expansion and value function (rollout function or value network) in node evaluation.
The planning is coupled with a visualization module for the display of found retrosynthetic routes.</p>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading">¶</a></h2>
<p>The retrosynthesis planning algorithm can be adjusted by the configuration file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tree</span><span class="p">:</span>
<span class="w">  </span><span class="nt">max_iterations</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">  </span><span class="nt">max_tree_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span>
<span class="w">  </span><span class="nt">max_time</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1200</span>
<span class="w">  </span><span class="nt">max_depth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9</span>
<span class="w">  </span><span class="nt">ucb_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">uct</span>
<span class="w">  </span><span class="nt">c_ucb</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="w">  </span><span class="nt">backprop_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">muzero</span>
<span class="w">  </span><span class="nt">search_strategy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">expansion_first</span>
<span class="w">  </span><span class="nt">exclude_small</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">  </span><span class="nt">init_node_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="w">  </span><span class="nt">min_mol_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6</span>
<span class="w">  </span><span class="nt">silent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="nt">node_evaluation</span><span class="p">:</span>
<span class="w">  </span><span class="nt">evaluation_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rollout</span>
<span class="w">  </span><span class="nt">evaluation_agg</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">max</span>
<span class="nt">node_expansion</span><span class="p">:</span>
<span class="w">  </span><span class="nt">top_rules</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50</span>
<span class="w">  </span><span class="nt">rule_prob_threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="w">  </span><span class="nt">priority_rules_fraction</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
</pre></div>
</div>
<p><strong>Configuration parameters</strong>:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>tree/max_iterations</cite> - the maximum number of iterations the tree search algorithm will perform.</p></li>
<li><p><cite>tree/max_tree_size</cite> - the maximum number of nodes that can be created in the search tree.</p></li>
<li><p><cite>tree/max_time</cite> - the maximum time (in seconds) for the tree search execution.</p></li>
<li><p><cite>tree/max_depth</cite> - the maximum depth of the tree, controlling how far the search can go from the root node.</p></li>
<li><p><cite>tree/ucb_type</cite> - the type of Upper Confidence Bound (UCB) used in the tree search. Options include “puct” (predictive UCB), “uct” (standard UCB), and “value”.</p></li>
<li><p><cite>tree/c_ucb</cite> - the parameter controlling the exploration-exploitation balance in UCB, which influences how much the algorithm favors the exploration of new paths versus the exploitation of known paths.</p></li>
<li><p><cite>tree/backprop_type</cite> - the backpropagation method used during the tree search. Options are “muzero” (model-based approach) and “cumulative” (cumulative reward approach).</p></li>
<li><p><cite>tree/search_strategy</cite> - the strategy for navigating the tree. Options are “expansion_first” (prioritizing the expansion of new nodes) and “evaluation_first” (prioritizing the evaluation of new nodes).</p></li>
<li><p><cite>tree/exclude_small</cite> - if True, excludes small molecules from the tree, typically focusing on more complex molecules.</p></li>
<li><p><cite>tree/init_node_value</cite> - the initial value for newly created nodes in the tree. This can impact how nodes are prioritized during the search.</p></li>
<li><p><cite>tree/epsilon</cite> - this parameter is used in the epsilon-greedy strategy during node selection, representing the probability of choosing a random action for exploration. A higher value leads to more exploration.</p></li>
<li><p><cite>tree/min_mol_size</cite> - the minimum size of a molecule (in terms of the number of heavy atoms) to be considered in the search. Molecules smaller than this threshold are typically considered readily available building blocks.</p></li>
<li><p><cite>tree/silent</cite> - if True, suppresses the progress logging of the tree search.</p></li>
<li><p><cite>node_evaluation/evaluation_agg</cite> - the way the evaluation scores are aggregated. Options are “max” (using the maximum score) and “average” (using the average score).</p></li>
<li><p><cite>node_evaluation/evaluation_type</cite> - the method used for node evaluation. Options include “random” (random number between 0 and 1), “rollout” (using rollout simulations), and “gcn” (graph convolutional networks).</p></li>
<li><p><cite>node_expansion/top_rules</cite> - the maximum amount of rules to be selected for node expansion from the list of predicted reaction rules.</p></li>
<li><p><cite>node_expansion/rule_prob_threshold</cite> - the reaction rules with predicted probability lower than this parameter will be discarded.</p></li>
<li><p><cite>node_expansion/priority_rules_fraction</cite> - the fraction of priority rules in comparison to th regular rules.</p></li>
</ul>
</div></blockquote>
</section>
<section id="cli">
<h2>CLI<a class="headerlink" href="#cli" title="Link to this heading">¶</a></h2>
<p>Retrosynthesis planning can be performed with the below command.</p>
<p><strong>Retrosynthesis planning with rollout evaluation</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>syntool<span class="w"> </span>planning<span class="w"> </span>--config<span class="w"> </span>planning.yaml<span class="w"> </span>--targets<span class="w"> </span>targets.smi<span class="w"> </span>--reaction_rules<span class="w"> </span>reaction_rules.pickle<span class="w"> </span>--building_blocks<span class="w"> </span>building_blocks.smi<span class="w"> </span>--policy_network<span class="w"> </span>policy_network.ckpt<span class="w"> </span>--results_dir<span class="w"> </span>planning
</pre></div>
</div>
<dl class="simple">
<dt><strong>Parameters</strong>:</dt><dd><ul class="simple">
<li><p><cite>config</cite> - the path to the configuration file.</p></li>
<li><p><cite>targets</cite> - the path to the file with target molecule for retrosynthesis planning.</p></li>
<li><p><cite>reaction_rules</cite> - the path to the file with reaction rules.</p></li>
<li><p><cite>building_blocks</cite> - the path to the file with building blocks.</p></li>
<li><p><cite>policy_network</cite> - the path to the file with trained policy network (ranking or filtering).</p></li>
<li><p><cite>results_dir</cite> - the path to the directory where the trained value network will be to be stored.</p></li>
</ul>
</dd>
</dl>
<p><strong>Retrosynthesis planning with value network evaluation</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>syntool<span class="w"> </span>planning<span class="w"> </span>--config<span class="w"> </span>planning.yaml<span class="w"> </span>--targets<span class="w"> </span>targets.smi<span class="w"> </span>--reaction_rules<span class="w"> </span>reaction_rules.pickle<span class="w"> </span>--building_blocks<span class="w"> </span>building_blocks.smi<span class="w"> </span>--policy_network<span class="w"> </span>policy_network.ckpt<span class="w"> </span>--value_network<span class="w"> </span>value_network.ckpt<span class="w"> </span>--results_dir<span class="w"> </span>planning
</pre></div>
</div>
<dl class="simple">
<dt><strong>Parameters</strong>:</dt><dd><ul class="simple">
<li><p><cite>config</cite> - the path to the configuration file.</p></li>
<li><p><cite>targets</cite> - the path to the file with target molecule for retrosynthesis planning.</p></li>
<li><p><cite>reaction_rules</cite> - the path to the file with reaction rules.</p></li>
<li><p><cite>building_blocks</cite> - the path to the file with building blocks.</p></li>
<li><p><cite>policy_network</cite> - the path to the file with trained policy network (ranking or filtering).</p></li>
<li><p><cite>value_network</cite> - the path to the file with trained value network (ranking or filtering).</p></li>
<li><p><cite>results_dir</cite> - the path to the directory where the trained value network will be to be stored.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="results-analysis">
<h2>Results analysis<a class="headerlink" href="#results-analysis" title="Link to this heading">¶</a></h2>
<p>After the retrosynthesis planning is finished, the user will see the folder containing the results. This folder will contain the following subfolders/files:</p>
<ul class="simple">
<li><p><cite>tree_search_stats.csv</cite> – the CSV table with planning statistics.</p></li>
<li><p><cite>extracted_routes.json</cite> – the retrosynthesis routes extracted from the search trees. Can be used for route analysis with programming utils.</p></li>
<li><p><cite>extracted_routes</cite> – the folder containing html files with visualized retrosynthesis routes extracted from the search trees. Can be used for the visual analysis of the extracted retrosynthesis routes.</p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">SynTool</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="user_guide.html">User guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_download.html">Data download</a></li>
<li class="toctree-l1"><a class="reference internal" href="reaction_mapping.html">Reaction mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="reaction_standardization.html">Reaction standardization</a></li>
<li class="toctree-l1"><a class="reference internal" href="reaction_filtration.html">Reaction filtration</a></li>
<li class="toctree-l1"><a class="reference internal" href="reaction_rules_extraction.html">Reaction rules extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="policy_network.html">Policy network</a></li>
<li class="toctree-l1"><a class="reference internal" href="value_network.html">Value network</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Retrosynthesis planning</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cli">CLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="#results-analysis">Results analysis</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="value_network.html" title="previous chapter">Value network</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, University of Strasbourg / Hokkaido University.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/retrosynthesis_planning.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>